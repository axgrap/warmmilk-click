# Warmmilk Click Client Library

A JavaScript client library for navigating and querying temporal project data generated by Warmmilk Click.

## Installation

### Browser (CDN)

```html
<script src="warmmilk-click-client.js"></script>
```

### Node.js

```javascript
const { WarmmilkClickClient } = require('./warmmilk-click-client.js');
```

### ES Modules

```javascript
import { WarmmilkClickClient } from './warmmilk-click-client.js';
```

## Quick Start

```javascript
// Create a client instance
const client = new WarmmilkClickClient('temporal-data.json');

// Load the data
await client.load();

// Get all projects
const projects = client.getProjects();

// Get a specific project
const project = client.getProject('example');

// Get commits
const commits = project.getCommits();

// Get images with version history
const images = project.getImages();
```

## API Reference

### WarmmilkClickClient

Main client class for loading and querying temporal data.

#### Constructor

```javascript
new WarmmilkClickClient(dataUrl)
```

- `dataUrl` (string): URL to the temporal-data.json file

#### Methods

##### `load()`
Load the temporal data from the server.

```javascript
await client.load();
```

Returns: `Promise<void>`

##### `getProjects()`
Get all projects.

```javascript
const projects = client.getProjects();
```

Returns: `Project[]`

##### `getProject(name)`
Get a specific project by name.

```javascript
const project = client.getProject('example');
```

Parameters:
- `name` (string): Project name

Returns: `Project|null`

##### `getMetadata()`
Get metadata about when data was generated.

```javascript
const metadata = client.getMetadata();
// { generatedAt: "2025-11-20T...", version: "1.0.0" }
```

Returns: `Object`

##### `getAllCommits()`
Get all commits across all projects, sorted by date descending.

```javascript
const allCommits = client.getAllCommits();
```

Returns: `Commit[]`

##### `searchCommits(query)`
Search commits by message.

```javascript
const results = client.searchCommits('bug fix');
```

Parameters:
- `query` (string): Search query

Returns: `Commit[]`

##### `getCommitsByAuthor(author)`
Get commits by author name or email.

```javascript
const commits = client.getCommitsByAuthor('john');
```

Parameters:
- `author` (string): Author name or email

Returns: `Commit[]`

##### `getCommitsByDateRange(startDate, endDate)`
Get commits in a date range.

```javascript
const commits = client.getCommitsByDateRange('2025-01-01', '2025-12-31');
```

Parameters:
- `startDate` (Date|string): Start date
- `endDate` (Date|string): End date

Returns: `Commit[]`

---

### Project

Represents a project with its commit history and files.

#### Properties

- `name` (string): Project name
- `path` (string): Project path

#### Methods

##### `getCommits()`
Get all commits in this project.

```javascript
const commits = project.getCommits();
```

Returns: `Commit[]`

##### `getClickFile()`
Get the click.md file data.

```javascript
const clickFile = project.getClickFile();
```

Returns: `ClickFile`

##### `getClickFileCommits()`
Get commits that modified click.md.

```javascript
const commits = project.getClickFileCommits();
```

Returns: `Commit[]`

##### `getBlameHistory()`
Get the blame history for click.md.

```javascript
const blameHistory = project.getBlameHistory();
```

Returns: `BlameLine[]`

##### `getImages()`
Get all images in this project.

```javascript
const images = project.getImages();
```

Returns: `ImageAsset[]`

##### `getImage(source)`
Get a specific image by source path.

```javascript
const image = project.getImage('images/logo.svg');
```

Parameters:
- `source` (string): Image source path

Returns: `ImageAsset|null`

##### `getCurrentContent()`
Get the current content of click.md.

```javascript
const content = project.getCurrentContent();
```

Returns: `string`

##### `getCommitsByAuthor(author)`
Get commits by author in this project.

```javascript
const commits = project.getCommitsByAuthor('jane');
```

Parameters:
- `author` (string): Author name or email

Returns: `Commit[]`

##### `getStats()`
Get project statistics.

```javascript
const stats = project.getStats();
// {
//   name: "example",
//   totalCommits: 10,
//   clickFileCommits: 5,
//   totalImages: 3,
//   linesTracked: 50,
//   authors: ["Alice", "Bob"],
//   dateRange: { first: "2025-01-01...", last: "2025-11-20..." }
// }
```

Returns: `Object`

---

### ClickFile

Represents a click.md file with its history and content.

#### Properties

- `path` (string): File path

#### Methods

##### `getCommits()`
Get commits that modified this file.

```javascript
const commits = clickFile.getCommits();
```

Returns: `Commit[]`

##### `getBlameHistory()`
Get blame history for all lines.

```javascript
const blameHistory = clickFile.getBlameHistory();
```

Returns: `BlameLine[]`

##### `getImages()`
Get images referenced in this file.

```javascript
const images = clickFile.getImages();
```

Returns: `ImageAsset[]`

##### `getCurrentContent()`
Get current file content.

```javascript
const content = clickFile.getCurrentContent();
```

Returns: `string`

##### `getLinesByAuthor(author)`
Get lines written by a specific author.

```javascript
const lines = clickFile.getLinesByAuthor('alice');
```

Parameters:
- `author` (string): Author name

Returns: `BlameLine[]`

##### `getLinesByCommit(commitSha)`
Get lines from a specific commit.

```javascript
const lines = clickFile.getLinesByCommit('a1e7730');
```

Parameters:
- `commitSha` (string): Commit SHA (full or short)

Returns: `BlameLine[]`

---

### Commit

Represents a git commit.

#### Properties

- `sha` (string): Full commit SHA
- `author` (string): Author name
- `email` (string): Author email
- `date` (string): Commit date (ISO format)
- `message` (string): Commit message
- `files` (string[]): Files changed in this commit

#### Methods

##### `getShortSha()`
Get short SHA (first 7 characters).

```javascript
const shortSha = commit.getShortSha(); // "a1e7730"
```

Returns: `string`

##### `getDate()`
Get commit date as Date object.

```javascript
const date = commit.getDate();
```

Returns: `Date`

##### `getFormattedDate(locale)`
Get formatted date string.

```javascript
const dateStr = commit.getFormattedDate('en-US');
```

Parameters:
- `locale` (string, optional): Locale for formatting. Default: 'en-US'

Returns: `string`

##### `modifiedClickFile()`
Check if this commit modified click.md.

```javascript
const modified = commit.modifiedClickFile(); // true/false
```

Returns: `boolean`

##### `modifiedImages()`
Check if this commit modified any images.

```javascript
const modified = commit.modifiedImages(); // true/false
```

Returns: `boolean`

##### `getProject()`
Get the project this commit belongs to.

```javascript
const project = commit.getProject();
```

Returns: `Project`

---

### BlameLine

Represents a line in the blame history.

#### Properties

- `lineStart` (number): Starting line number
- `lineEnd` (number): Ending line number
- `commit` (string): Commit SHA
- `author` (string): Author name
- `email` (string): Author email
- `date` (string): Date (ISO format)
- `content` (string): Line content
- `originalLineStart` (number): Original line number in commit

#### Methods

##### `getCommitSha()`
Get the commit that introduced this line.

```javascript
const sha = blameLine.getCommitSha();
```

Returns: `string`

##### `getShortSha()`
Get short commit SHA.

```javascript
const shortSha = blameLine.getShortSha();
```

Returns: `string`

##### `getDate()`
Get line date as Date object.

```javascript
const date = blameLine.getDate();
```

Returns: `Date`

##### `getFormattedDate(locale)`
Get formatted date string.

```javascript
const dateStr = blameLine.getFormattedDate('en-US');
```

Parameters:
- `locale` (string, optional): Locale for formatting

Returns: `string`

##### `isEmpty()`
Check if this is an empty line.

```javascript
const empty = blameLine.isEmpty(); // true/false
```

Returns: `boolean`

##### `getClickFile()`
Get the ClickFile this line belongs to.

```javascript
const clickFile = blameLine.getClickFile();
```

Returns: `ClickFile`

---

### ImageAsset

Represents an image asset with version history.

#### Properties

- `source` (string): Original image path in markdown
- `destination` (string): Path in assets directory
- `fullPath` (string): Full filesystem path
- `currentSize` (number): Current file size in bytes
- `versionCount` (number): Number of versions
- `versions` (ImageVersion[]): Array of image versions

#### Methods

##### `getUrl()`
Get the destination URL for this image.

```javascript
const url = image.getUrl(); // "assets/example/images/logo.svg"
```

Returns: `string`

##### `getVersions()`
Get all versions of this image.

```javascript
const versions = image.getVersions();
```

Returns: `ImageVersion[]`

##### `getLatestVersion()`
Get the latest version.

```javascript
const latest = image.getLatestVersion();
```

Returns: `ImageVersion|null`

##### `getFirstVersion()`
Get the first version (when image was added).

```javascript
const first = image.getFirstVersion();
```

Returns: `ImageVersion|null`

##### `getFormattedSize()`
Get formatted file size.

```javascript
const size = image.getFormattedSize(); // "226 Bytes"
```

Returns: `string`

##### `hasMultipleVersions()`
Check if image has multiple versions.

```javascript
const hasMultiple = image.hasMultipleVersions(); // true/false
```

Returns: `boolean`

##### `getVersionStats()`
Get version history statistics.

```javascript
const stats = image.getVersionStats();
// {
//   count: 3,
//   currentSize: 2048,
//   minSize: 1024,
//   maxSize: 2048,
//   averageSize: 1536,
//   sizeChange: 512,
//   dateRange: { first: "2025-01-01...", last: "2025-11-20..." }
// }
```

Returns: `Object|null`

##### `getClickFile()`
Get the ClickFile this image belongs to.

```javascript
const clickFile = image.getClickFile();
```

Returns: `ClickFile`

---

### ImageVersion

Represents a specific version of an image.

#### Properties

- `sha` (string): Commit SHA where this version was introduced
- `author` (string): Author who made this change
- `email` (string): Author email
- `date` (string): Date of this version
- `message` (string): Commit message
- `size` (number): File size in bytes at this version

#### Methods

##### `getShortSha()`
Get short SHA.

```javascript
const shortSha = version.getShortSha();
```

Returns: `string`

##### `getDate()`
Get version date as Date object.

```javascript
const date = version.getDate();
```

Returns: `Date`

##### `getFormattedDate(locale)`
Get formatted date string.

```javascript
const dateStr = version.getFormattedDate('en-US');
```

Parameters:
- `locale` (string, optional): Locale for formatting

Returns: `string`

##### `getFormattedSize()`
Get formatted file size.

```javascript
const size = version.getFormattedSize(); // "225 Bytes"
```

Returns: `string`

##### `getImageAsset()`
Get the ImageAsset this version belongs to.

```javascript
const imageAsset = version.getImageAsset();
```

Returns: `ImageAsset`

---

## Usage Examples

### Example 1: Basic Navigation

```javascript
const client = new WarmmilkClickClient('temporal-data.json');
await client.load();

// Get all projects
const projects = client.getProjects();
console.log(`Found ${projects.length} projects`);

// Get first project
const project = projects[0];
console.log(`Project: ${project.name}`);
console.log(`Path: ${project.path}`);

// Get project stats
const stats = project.getStats();
console.log(`Total commits: ${stats.totalCommits}`);
console.log(`Authors: ${stats.authors.join(', ')}`);
```

### Example 2: Working with Commits

```javascript
const client = new WarmmilkClickClient('temporal-data.json');
await client.load();

// Get all commits
const allCommits = client.getAllCommits();

// Search commits
const bugFixes = client.searchCommits('bug fix');
console.log(`Found ${bugFixes.length} bug fix commits`);

// Get commits by author
const myCommits = client.getCommitsByAuthor('alice@example.com');
console.log(`Alice made ${myCommits.length} commits`);

// Get recent commits
const lastWeek = new Date();
lastWeek.setDate(lastWeek.getDate() - 7);
const recentCommits = client.getCommitsByDateRange(lastWeek, new Date());
console.log(`${recentCommits.length} commits in the last week`);
```

### Example 3: Analyzing Image History

```javascript
const client = new WarmmilkClickClient('temporal-data.json');
await client.load();

const project = client.getProject('example');
const images = project.getImages();

images.forEach(image => {
    console.log(`\nImage: ${image.source}`);
    console.log(`Size: ${image.getFormattedSize()}`);
    console.log(`Versions: ${image.versionCount}`);
    
    // Get version history
    const versions = image.getVersions();
    versions.forEach((version, idx) => {
        console.log(`  v${versions.length - idx}: ${version.getShortSha()} - ${version.getFormattedDate()}`);
        console.log(`    Size: ${version.getFormattedSize()}`);
        console.log(`    ${version.message}`);
    });
    
    // Get statistics
    if (image.hasMultipleVersions()) {
        const stats = image.getVersionStats();
        console.log(`  Size change: ${stats.sizeChange > 0 ? '+' : ''}${stats.sizeChange} bytes`);
    }
});
```

### Example 4: Blame History Analysis

```javascript
const client = new WarmmilkClickClient('temporal-data.json');
await client.load();

const project = client.getProject('example');
const clickFile = project.getClickFile();

// Get all blame history
const blameHistory = clickFile.getBlameHistory();
console.log(`Tracking ${blameHistory.length} lines`);

// Find who wrote the most lines
const authorCounts = {};
blameHistory.forEach(line => {
    if (!line.isEmpty()) {
        authorCounts[line.author] = (authorCounts[line.author] || 0) + 1;
    }
});

console.log('\nLines by author:');
Object.entries(authorCounts)
    .sort((a, b) => b[1] - a[1])
    .forEach(([author, count]) => {
        console.log(`  ${author}: ${count} lines`);
    });

// Get lines from a specific author
const aliceLines = clickFile.getLinesByAuthor('alice');
console.log(`\nAlice wrote ${aliceLines.length} lines`);
```

### Example 5: Building a Timeline

```javascript
const client = new WarmmilkClickClient('temporal-data.json');
await client.load();

const project = client.getProject('example');

// Get all events (commits and image changes)
const commits = project.getCommits();
const images = project.getImages();

const timeline = [];

// Add commits
commits.forEach(commit => {
    timeline.push({
        type: 'commit',
        date: commit.getDate(),
        description: commit.message,
        author: commit.author
    });
});

// Add image versions
images.forEach(image => {
    image.getVersions().forEach(version => {
        timeline.push({
            type: 'image',
            date: version.getDate(),
            description: `Updated ${image.source}`,
            author: version.author,
            size: version.getFormattedSize()
        });
    });
});

// Sort by date
timeline.sort((a, b) => b.date - a.date);

// Display timeline
console.log('Project Timeline:');
timeline.forEach(event => {
    console.log(`${event.date.toLocaleDateString()} - ${event.type}: ${event.description} (${event.author})`);
});
```

### Example 6: Custom Queries

```javascript
const client = new WarmmilkClickClient('temporal-data.json');
await client.load();

// Find projects with images
const projectsWithImages = client.getProjects().filter(p => p.getImages().length > 0);
console.log(`${projectsWithImages.length} projects have images`);

// Find images that have been modified
const modifiedImages = [];
client.getProjects().forEach(project => {
    project.getImages().forEach(image => {
        if (image.hasMultipleVersions()) {
            modifiedImages.push({
                project: project.name,
                image: image.source,
                versions: image.versionCount
            });
        }
    });
});

console.log('\nModified images:');
modifiedImages.forEach(item => {
    console.log(`  ${item.project}/${item.image}: ${item.versions} versions`);
});

// Find most active author
const commitCounts = {};
client.getAllCommits().forEach(commit => {
    commitCounts[commit.author] = (commitCounts[commit.author] || 0) + 1;
});

const mostActive = Object.entries(commitCounts)
    .sort((a, b) => b[1] - a[1])[0];

console.log(`\nMost active author: ${mostActive[0]} (${mostActive[1]} commits)`);
```

## Browser Integration

The client library can be easily integrated into your web application:

```html
<!DOCTYPE html>
<html>
<head>
    <title>My Temporal View</title>
    <script src="warmmilk-click-client.js"></script>
</head>
<body>
    <div id="projects"></div>
    
    <script>
        async function init() {
            const client = new WarmmilkClickClient('temporal-data.json');
            await client.load();
            
            const container = document.getElementById('projects');
            const projects = client.getProjects();
            
            projects.forEach(project => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <h2>${project.name}</h2>
                    <p>Commits: ${project.getCommits().length}</p>
                    <p>Images: ${project.getImages().length}</p>
                `;
                container.appendChild(div);
            });
        }
        
        init();
    </script>
</body>
</html>
```

## TypeScript Support

Type definitions are included in the library. For TypeScript projects:

```typescript
import { WarmmilkClickClient, Project, Commit } from './warmmilk-click-client';

const client: WarmmilkClickClient = new WarmmilkClickClient('temporal-data.json');
await client.load();

const projects: Project[] = client.getProjects();
const commits: Commit[] = client.getAllCommits();
```

## License

This client library is part of the Warmmilk Click project and follows the same license.
